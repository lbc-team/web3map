# [椭圆曲线密码学](https://learnblockchain.cn/tags/椭圆曲线密码学)

## 概念简介

[椭圆曲线密码学](https://learnblockchain.cn/tags/椭圆曲线密码学)（Elliptic Curve Cryptography，缩写 ECC）是一种基于椭圆曲线数学的公开密钥加密算法。与传统的 RSA 等基于大整数分解的密码系统不同，ECC 的安全性基于椭圆曲线离散对数问题（ECDLP）的计算困难性。

ECC 的核心优势在于：在提供相同安全级别的前提下，使用更短的密钥长度，从而降低计算成本、存储需求和带宽消耗。一个 256 位的 ECDSA 签名具有与 3072 位 RSA 签名相同的安全强度，使其在资源受限的环境（如移动设备、物联网）和区块链应用中特别有价值。

## 核心原理

**椭圆曲线方程**

椭圆曲线在数学上由以下方程定义（Weierstrass 形式）：
```
y² = x³ + ax + b
```

在有限域上，椭圆曲线形成一个有限点集，这些点满足上述方程并加上一个无穷远点 O（作为群的单位元）。

**点运算**

椭圆曲线上定义了两种基本运算：
1. **点加法**：给定曲线上两点 P 和 Q，可以定义第三点 R = P + Q
2. **标量乘法**：给定点 P 和整数 k，可以计算 kP = P + P + ... + P（k次）

**离散对数问题（ECDLP）**

这个问题就是椭圆曲线中的离散对数问题，它被认为是一个很难很难的问题。给定椭圆曲线上的两点 G（基点）和 Q，找到整数 k 使得 Q = kG 在计算上是不可行的。这就是 ECC 安全性的数学基础。

**单向陷门函数**

- 正向计算很简单：计算 kG 可以用快速幂算法在多项式时间内完成
- 逆向计算很难：已知 G 和 kG，求解 k 需要指数时间复杂度
- 不管是 RSA、离散对数加密还是椭圆曲线加密，公钥加密算法都是依赖于这种正向简单、逆向困难的数学难题

## 主要算法

**ECDH（Elliptic [Curve](https://learnblockchain.cn/tags/Curve?map=EVM) Diffie-Hellman）**

椭圆曲线迪菲-赫尔曼密钥交换协议，用于在双方之间创建共享密钥。在密钥交换中使用 ECDH。

**工作原理：**
1. Alice 选择私钥 a，计算公钥 A = aG
2. Bob 选择私钥 b，计算公钥 B = bG
3. Alice 计算共享密钥 K = aB = a(bG)
4. Bob 计算共享密钥 K = bA = b(aG)
5. 由于 a(bG) = b(aG) = (ab)G，双方得到相同的共享密钥

**ECDSA（Elliptic [Curve](https://learnblockchain.cn/tags/Curve?map=EVM) Digital Signature Algorithm）**

椭圆曲线数字签名算法，用于对数据进行数字签名和验证。在数字签名中使用 ECDSA。

**签名过程：**
1. 对消息 m 计算哈希 h = Hash(m)
2. 选择随机数 k，计算 R = kG，取 r = R.x（R 的 x 坐标）
3. 计算 s = k⁻¹(h + r·私钥) mod n
4. 签名为 (r, s)

**验证过程：**
1. 计算 u₁ = h·s⁻¹ mod n，u₂ = r·s⁻¹ mod n
2. 计算 R' = u₁G + u₂·公钥
3. 验证 R'.x ≡ r (mod n)

## 常用曲线

**secp256k1**

比特币和以太坊使用的椭圆曲线，方程为 y² = x³ + 7。

**特点：**
- 由于其特殊构造，优化后的实现比其他曲线性能上可以提高 30%
- 占用很少的带宽和存储资源，密钥长度很短
- 中本聪选择了 secp256k1 而不是 NIST 定义的曲线，避免潜在后门风险
- 让所有用户都可以使用同样的操作完成域运算

**应用：**
- 比特币是第一个也是最著名的采用 secp256k1 的加密货币
- 以太坊为了与比特币互操作性采用了 secp256k1
- 莱特币等众多加密货币

**secp256r1（P-256 / prime256v1）**

NIST 标准化的曲线，也称为 P-256。

**争议：**
- NSA 对 SECP256r1 曲线安置了后门陷阱的质疑
- 许多人质疑 NIST 和 NSA 之间的密切关系
- 这是社区对该曲线存在疑虑的原因之一

**secp256k1 与 secp256r1 的区别：**
- SECP256K1 和 SECP256R1 之间的唯一区别是它们各自椭圆曲线的曲线参数
- 所有计算都完全相同，只是输入参数不同
- secp256k1 性能更优，比 secp256r1 快约 30%

**Curve25519 / Ed25519**

由 Daniel J. Bernstein 设计的现代椭圆曲线。

**特点：**
- Curve25519 提供 128 位安全性（256 位密钥大小）
- 比 secp256k1 和 NIST 曲线更快更安全
- X25519 用于 ECDH 密钥交换，Ed25519 用于 EdDSA 签名
- Curve25519 和 Edwards25519（Ed25519）曲线是双有理等价的（互为"扭曲"）

**应用：**
- OpenSSH 默认签名方案
- Signal 端到端加密消息
- DNSSEC
- Git 仓库签名
- TLS 协议和 VPN 隧道

**其他常见曲线：**
- **P-384 / secp384r1**：更高安全级别（192 位安全性）
- **P-521 / secp521r1**：最高安全级别（260 位安全性）
- **brainpoolP256r1**：欧洲标准

## 安全性分析

**ECC 的安全性**

secp256k1 的安全性源于椭圆曲线离散对数问题（ECDLP），对于选择良好的曲线和足够大的密钥大小，ECDLP 被认为在计算上是不可行的。secp256k1 中使用的 256 位密钥具有很高的安全性，使其能够抵御已知的攻击。

**密钥长度对比（相同安全级别）：**

| 安全级别 | ECC 密钥长度 | RSA 密钥长度 | 对称加密等效 |
|---------|-------------|-------------|-------------|
| 80 位   | 160 位      | 1024 位     | DES-80      |
| 112 位  | 224 位      | 2048 位     | 3DES        |
| 128 位  | 256 位      | 3072 位     | AES-128     |
| 192 位  | 384 位      | 7680 位     | AES-192     |
| 256 位  | 521 位      | 15360 位    | AES-256     |

**量子威胁**

与 RSA 类似，ECC 也容易受到 Shor 量子算法的攻击。量子计算机可以在多项式时间内解决椭圆曲线离散对数问题。需要迁移到后量子密码算法。

## 在区块链中的应用

**比特币**

采用比特币的核心是使用 ECDSA（椭圆曲线数字签名算法），并且可以通过公共标识符来验证交易。

- 使用 secp256k1 曲线
- 私钥 → 公钥（通过椭圆曲线点乘）
- 公钥 → 地址（通过哈希）
- 交易签名使用 ECDSA

**以太坊**

所有以太坊库默认只支持 SECP256K1，因为这是公共[以太坊](https://learnblockchain.cn/tags/以太坊?map=EVM)网络中使用的签名算法。

- 为了与比特币互操作性采用 secp256k1
- 地址是公钥的 Keccak-256 哈希的后 20 字节
- [智能合约](https://learnblockchain.cn/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6)的 ecrecover 函数用于验证签名

**新一代区块链**

- **[Solana](https://learnblockchain.cn/tags/Solana?map=Solana)**：使用 Ed25519 签名，性能更高
- **Cardano**：使用 Ed25519
- **Polkadot**：使用 Ed25519（Schnorrkel/Ristretto）
- **Algorand**：使用 Ed25519

## 性能优势

**计算效率**

- ECC 的密钥生成、签名和验证速度都比 RSA 快
- 在相同安全级别下，ECC 比 RSA 快 10-40 倍

**存储和带宽**

- 256 位 ECC 密钥 vs 3072 位 RSA 密钥
- 签名大小：ECDSA 64 字节 vs RSA 384 字节
- 节省 85% 以上的存储空间

**移动和嵌入式设备**

- 更少的内存占用
- 更快的计算速度
- 更低的功耗

## 实现和库

**常用库：**
- **OpenSSL**：支持多种椭圆曲线的 C 库
- **libsecp256k1**：[比特币](https://learnblockchain.cn/tags/比特币?map=BTC)核心使用的优化库
- **elliptic.js**：[JavaScript](https://learnblockchain.cn/tags/JavaScript) 实现
- **py_ecc**：Python 实现
- **Bouncy Castle**：Java/C# 实现

## 安全协议应用

**TLS/SSL**

传输层安全协议中使用 ECDH 进行密钥交换，使用 ECDSA 进行身份验证。现代 TLS 1.3 优先使用椭圆曲线算法。

**SSH**

安全外壳协议支持 ECDSA 和 Ed25519 密钥，Ed25519 现在是 OpenSSH 的推荐默认选项。

**VPN**

许多 VPN 协议（如 WireGuard）使用 Curve25519 进行密钥交换。

## 推荐阅读

**中文资源：**
- [椭圆曲线密码学入门篇 - 登链社区](https://learnblockchain.cn/article/8731)
- [指南：关于secp256k1、ECDH、ECDSA - 登链社区](https://learnblockchain.cn/article/5189)
- [一文说明白ECDSA secp256k1 secp256r1 EdDSA ed25519千丝万缕的关系 - CSDN](https://blog.csdn.net/feeltouch/article/126070640)
- [ECC椭圆曲线加密算法：有限域和离散对数 - 知乎](https://zhuanlan.zhihu.com/p/44743146)
- [椭圆曲线密码学：有限域和离散对数 - 博客园](https://www.cnblogs.com/Duxue/p/15008735.html)
- [Secp256k1：加密货币的关键算法 - Nervos](https://www.nervos.org/zh/knowledge-base/secp256k1_a_key%20algorithm_(explainCKBot))
- [椭圆曲线加密与NSA后门考古](https://evilpan.com/2020/05/17/ec-crypto/)
- [椭圆曲线密码学 - 维基百科](https://zh.wikipedia.org/zh-hans/椭圆曲线密码学)

**英文资源：**
- [Elliptic Curve Cryptography (ECC) - Practical Cryptography for Developers](https://cryptobook.nakov.com/asymmetric-key-ciphers/elliptic-curve-cryptography-ecc)
- [Everything you wanted to know about Elliptic Curve Cryptography - Fission](https://fission.codes/blog/everything-you-wanted-to-know-about-elliptic-curve-cryptography/)
- [Curve25519: high-speed elliptic-curve cryptography](https://cr.yp.to/ecdh.html)
- [So, What Is Ed25519? - Medium](https://medium.com/asecuritysite-when-bob-met-alice/so-what-is-ed25519-and-what-does-it-have-to-do-with-curve-25519-f229804f2d08)
- [Safe curves for elliptic cryptography](https://www.cryptosys.net/pki/manpki/pki_eccsafecurves.html)

## 相关概念

- **公钥密码学**
- **ECDSA**
- **ECDH**
- **secp256k1**
- **Ed25519**
- **离散对数问题**
- **数字签名**
- **[比特币](https://learnblockchain.cn/tags/比特币?map=BTC)**
- **[以太坊](https://learnblockchain.cn/tags/以太坊?map=EVM)**
- **后量子密码学**
