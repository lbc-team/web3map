## EIP-4444

### 概念简介

EIP-4444（Bound Historical Data in Execution Clients）是一项以太坊改进提案，旨在通过限制执行客户端存储的历史数据来减少节点存储需求。该提案要求客户端停止在 P2P 层提供超过一年的历史区块头、区块体和收据，并允许客户端在本地修剪这些历史数据。

这项提案是以太坊可持续性发展的重要一步，通过减少历史数据存储，降低了运行全节点的硬件门槛，使更多人能够参与网络验证。

### 核心动机

**存储压力问题**
历史区块和收据当前占用超过 400GB 的磁盘空间（且不断增长），这要求用户通常需要 1TB 的磁盘来验证链。随着网络的持续运行，这个数字还在不断增加，对节点运营者造成了巨大的存储负担。

**历史数据非必需性**
历史数据对于验证新区块不是必需的。一旦客户端同步到链的顶端，历史数据只在以下情况下被检索：
- 通过 JSON-RPC 明确请求
- 对等节点尝试同步链时

对于大多数日常验证操作，这些历史数据是不必要的。

### 实施细节

**数据修剪策略**
客户端可以选择修剪超过指定期限（通常为一年）的：
- 历史区块头
- 区块体
- 交易收据

**P2P 层变化**
执行客户端将不再在 P2P 层提供老旧的历史数据，这意味着新节点无法通过传统的 devp2p 协议进行完整历史同步。

**弱主观性检查点**
新节点必须使用有效的弱主观性检查点（Weak Subjectivity Checkpoint）从链的较新视图启动，而不是从创世区块开始同步。

### 实施状态

**2025 年进展**
截至 2025 年 7 月，所有以太坊执行客户端都支持符合 EIP-4444 的部分历史过期功能：
- Geth
- Besu
- Nethermind
- Erigon

**存储节省**
用户可以通过删除合并（The Merge）之前的区块数据，预计减少 **300-500 GB** 的磁盘空间需求。虽然完整的滚动历史过期工作仍在进行中，但部分实施已经显著改善了存储状况。

### 历史数据保存

**分布式存储方案**
保存以太坊历史是至关重要的，EIP-4444 并不意味着历史数据的丢失，而是采用分布式的带外存储方式：

- **Torrent 网络**：历史数据可以打包并通过 BitTorrent 磁力链接共享
- **[IPFS](https://learnblockchain.cn/tags/IPFS)**：利用星际文件系统的去中心化存储
- **Portal Network**：专门为轻客户端设计的历史数据访问网络
- **The Graph**：通过索引服务访问历史区块链数据
- **档案节点**：专门的档案节点可以选择保留完整历史

**数据可获得性**
虽然常规验证节点不再强制保留完整历史，但历史数据仍然可以通过多种渠道获取，确保了以太坊的历史可审计性和透明度。

### 对生态系统的影响

**节点运营者**
- 降低硬件成本：不再需要 TB 级别的存储
- 提高准入门槛：更多人可以运行全节点
- 同步速度提升：初始同步时间大幅减少

**应用开发者**
- 历史数据查询需要调整：不能依赖所有节点都有完整历史
- 需要使用专门的归档服务：如 Infura、Alchemy 的归档节点
- RPC 调用行为变化：某些历史查询可能失败

**区块链浏览器**
区块链浏览器（如 Etherscan）需要运行归档节点或使用替代数据源来提供完整的历史数据访问。

### 技术考量

**同步机制变化**
传统的完整同步（Full Sync）将不再可行，新节点需要：
1. 从受信任的来源获取弱主观性检查点
2. 从检查点开始同步，而不是从创世区块
3. 验证检查点之后的所有区块

**安全性保障**
弱主观性检查点的安全性依赖于：
- 社区共识和透明度
- 多个独立来源的交叉验证
- 客户端内置的检查点验证机制

### 未来展望

**完整实施**
EIP-4444 的完整实施包括滚动历史过期（Rolling History Expiry），即自动删除超过设定时间窗口的历史数据。目前这项工作仍在持续推进。

**与其他提案的协同**
EIP-4444 与其他[以太坊](https://learnblockchain.cn/tags/以太坊?map=EVM)可扩展性提案形成协同：
- **EIP-4844**（Blob 数据）：blob 数据本身就设计为临时存储
- **Danksharding**：未来的分片方案也依赖类似的数据过期机制
- **Portal Network**：为轻客户端提供历史数据访问

**长期愿景**
通过 EIP-4444，[以太坊](https://learnblockchain.cn/tags/以太坊?map=EVM)向更可持续、更去中心化的方向发展，降低了参与网络验证的门槛，同时通过分布式存储方案确保历史数据的可用性。

### 相关链接

- [EIP-4444 官方规范](https://learnblockchain.cn/docs/eips/EIPS/eip-4444)
- [以太坊基金会博客：部分历史过期公告](https://blog.ethereum.org/2025/07/08/partial-history-exp)
- [EIP-4444 实施计划](https://hackmd.io/@hBXHLw_9Qq2va4pRtI4bIA/ryzBaf7fJx)
- [Portal Network 官网](https://www.ethportal.net/)
