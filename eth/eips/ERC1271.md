## ERC-1271: 合约签名验证标准

ERC-1271 是一个以太坊标准，定义了智能合约如何验证签名的方法。

### 解决的问题
在以太坊中，外部账户（EOA）可以使用其私钥对消息进行签名（如使用 ECDSA 算法），任何人都可以使用公钥验证该签名。然而，智能合约（Smart Contracts）没有私钥，因此无法像 EOA 那样生成传统的签名。
随着智能合约钱包（如 Safe, Argent）和账户抽象（Account Abstraction）的兴起，我们需要一种标准方法来让合约“签署”消息，并让第三方（如 DApp、交易所）验证这些签名是否有效。

### 实现机制与原理
ERC-1271 定义了一个单一的函数接口：
```solidity
function isValidSignature(bytes32 _hash, bytes memory _signature) public view returns (bytes4);
```
*   **_hash:** 待验证数据的哈希值。
*   **_signature:** 签名数据（格式由具体的合约实现定义）。
*   **返回值:** 如果签名有效，必须返回魔术值 `0x1626ba7e` (即 `bytes4(keccak256("isValidSignature(bytes32,bytes)"))`)；否则返回其他值。

**验证流程：**
1.  用户（或合约所有者）生成一个签名（通常是 EOA 签名）。
2.  验证者（如 OpenSea 或 Uniswap 合约）调用钱包合约的 `isValidSignature` 函数，传入消息哈希和签名。
3.  钱包合约内部执行自定义的验证逻辑（例如：检查签名者是否是合约的所有者，或者是否满足多签门槛）。
4.  如果验证通过，函数返回魔术值，验证者确认签名有效。

### 主要特点
*   **灵活性:** 允许任意的验证逻辑（单签、多签、BLS 签名、社交恢复等）。
*   **互操作性:** 使得 DApp 可以像支持普通 EOA 一样支持智能合约钱包登录和交互。
*   **链下签名，链上验证:** 支持 EIP-712 结构化数据签名。

### 常见应用场景
*   **智能合约钱包登录 (SIWE):** 允许用户通过合约钱包登录 Web3 应用。
*   **NFT 市场挂单:** 智能合约钱包可以在 OpenSea 等市场上进行免 Gas 的挂单。
*   **去中心化交易所 (DEX):** 支持合约钱包签署限价单（Limit Orders）。

### 推荐阅读
*   [EIP-1271 Standard](https://eips.ethereum.org/EIPS/eip-1271)
*   [Safe: Smart Contract Signatures](https://docs.safe.global/learn/safe-core/safe-core-protocol/signatures)
