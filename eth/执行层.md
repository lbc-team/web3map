# 执行层 (Execution Layer)

执行层（Execution Layer, EL）是以太坊网络在“合并（The Merge）”升级后的核心组成部分之一，前身为以太坊 1.0 链。它负责处理交易、执行智能合约逻辑以及维护以太坊的全局状态。

## 要解决的问题

在以太坊从工作量证明（PoW）转向权益证明（PoS）的过程中，为了实现更清晰的架构设计和更高效的升级路径，以太坊采用了模块化的设计思路。需要解决的核心问题是**关注点分离**：

1.  **复杂性管理**：将复杂的共识逻辑（谁有权出块）与状态转换逻辑（区块内容是什么）解耦，使得两层可以独立开发和优化。
2.  **客户端多样性**：允许不同的团队专注于构建共识客户端或执行客户端，降低了单一软件堆栈的风险。

## 实现机制与原理

在当前的以太坊架构中，节点通常同时运行一个**执行客户端**（Execution Client）和一个**共识客户端**（Consensus Client，又称信标节点）。两者通过**引擎 API（Engine API）**进行通信。

### 职责分工
*   **执行层（EL）**：
    *   **交易池管理**：接收、验证并传播用户广播的交易（Gossip 协议）。
    *   **区块构建**：打包交易，生成区块体（Payload）。
    *   **状态执行**：通过以太坊虚拟机（EVM）执行交易，更新账户余额、合约存储等世界状态树。
    *   **数据存储**：维护区块链的历史数据和当前状态数据库。

*   **共识层（CL）**：
    *   负责权益证明（PoS）逻辑，包括验证者管理、分叉选择规则（LMD GHOST）和区块最终性确认（Casper FFG）。
    *   CL 指挥 EL 何时构建区块、何时验证特定的区块载荷（Payload）。

### 交互流程
当一个验证者被选中出块时：
1.  其共识客户端请求执行客户端构建一个包含交易的“执行载荷”。
2.  执行客户端打包交易、执行并返回结果。
3.  共识客户端将此载荷包含在信标区块中，并在网络上广播。
4.  其他节点的共识客户端接收区块，并指令其执行客户端验证该载荷的有效性。

## 主要特点

*   **EVM 宿主**：执行层是 EVM 实际运行的地方，是所有去中心化应用（DApps）的生存环境。
*   **模块化架构**：执行层可以与不同的共识层（甚至是 Layer 2 的排序器）配合工作，这种灵活性是 Rollup 扩容技术的基础。
*   **丰富的客户端生态**：目前主流的执行层客户端包括 **Geth** (Go), **Nethermind** (C#), **Besu** (Java), **Reth** (Rust) 和 **Erigon** (Go) 等。

## 推荐阅读

*   [Ethereum.org: The Execution Layer](https://ethereum.org/en/developers/docs/nodes-and-clients/#execution-clients)
*   [EIP-3675: Upgrade consensus to Proof-of-Stake](https://eips.ethereum.org/EIPS/eip-3675)
*   [The Merge Documentation](https://ethereum.org/en/roadmap/merge/)

## 相关概念

*   **共识层 (Consensus Layer / Beacon Chain)**
*   **Engine API**
*   **The Merge (合并)**
*   **EVM**
