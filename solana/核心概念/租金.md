## 租金

租金（Rent）是 Solana 用来保持账户数据活跃的机制。在 Solana 中，存储账户数据需要支付租金，以防止区块链状态无限增长。不过，当前实现中，只要账户余额达到"租金豁免"标准，就无需持续支付租金。

### 租金机制

**租金计算**
租金基于账户占用的存储空间计算：
```
租金 = 账户大小（字节）× 每字节租金费率 × 时间
```

**每字节费率**
- 当前约为 0.00000348 SOL/字节/epoch
- 1 epoch 约 2-3 天
- 费率可通过治理调整

**租金豁免**
账户余额达到一定阈值后，可永久免除租金：
```
租金豁免余额 = 账户大小 × 每字节租金 × 2年
```

例如，一个 165 字节的账户需要约 0.00114 SOL 才能免租。

### 当前状态

**强制租金豁免**
自 2021 年起，Solana 要求所有新账户必须达到租金豁免标准：
- 创建账户时必须存入足够 SOL
- 不豁免的账户无法创建
- 已存在的非豁免账户逐步被回收

这简化了开发，开发者无需担心租金收取。

### 账户创建

**计算租金豁免金额**
```rust
let rent = Rent::get()?;
let space = 165; // 账户大小
let lamports = rent.minimum_balance(space);
```

**创建账户**
```rust
invoke(
    &system_instruction::create_account(
        payer.key,
        new_account.key,
        lamports, // 租金豁免余额
        space as u64,
        program_id,
    ),
    &[payer, new_account],
)?;
```

### 关闭账户

**回收 SOL**
关闭账户时，租金豁免的 SOL 可以回收：
```rust
**destination.lamports() += source.lamports();
**source.lamports() = 0;
```

这是程序优化存储成本的重要手段。

### 与其他链对比

| 链 | 存储成本模型 |
|------|------------|
| Solana | 一次性支付（租金豁免） |
| Ethereum | Gas 费 + 永久存储 |
| Near | 质押代币锁定存储 |
| Arweave | 一次性支付永久存储 |

### 存储优化

**1. 压缩数据**
使用紧凑的数据结构：
```rust
#[account]
pub struct CompactData {
    pub value: u32,  // 而不是 u64
    pub flag: bool,  // 1 字节
}
```

**2. 使用 PDA**
合并多个用户数据到一个账户。

**3. 关闭不用的账户**
及时回收租金。

**4. Zero-copy**
对大数据使用 zero-copy，避免拷贝开销：
```rust
#[account(zero_copy)]
pub struct LargeData {
    pub data: [u64; 1000],
}
```

### 相关概念

- **Lamports**：SOL 的最小单位，1 SOL = 1,000,000,000 lamports
- **Epoch**：Solana 的时间周期，约 2-3 天
- **AccountsDB**：存储所有账户数据的数据库
- **State Rent**：以太坊提出的类似租金概念（未实现）
